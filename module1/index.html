<!DOCTYPE html>
<html>

<head>
    <title>Getting Started with Microsoft identity</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.7.2/bluebird.min.js"></script>
    <script src="https://alcdn.msauth.net/browser/2.14.2/js/msal-browser.js"></script>
</head>

<body>
    <div class="container">
        <div>
            <p id="WelcomeMessage">Microsoft Authentication Library For Javascript (MSAL.js) Exercise</p>
            <button id="SignIn" onclick="signIn()">Sign In</button>
        </div>
    </div>
    <script>
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf('MSIE ');
        var msie11 = ua.indexOf('Trident/');
        var msedge = ua.indexOf('Edge/');
        var isIE = msie > 0 || msie11 > 0;
        var isEdge = msedge > 0;

        var msalConfig = {
            auth: {
                clientId: '0e010870-42d4-4bfe-867b-01e49ca83f2b',
                authority: 'https://login.microsoftonline.com/3a6831ab-6304-4c72-8d08-3afe544555dd'
            },
            cache: {
                cacheLocation: "localStorage",
                storeAuthStateInCookie: isIE || isEdge
            }
        };

        var msalApplication = new msal.PublicClientApplication(msalConfig);
        var userName = "";
        var loginType = isIE ? "REDIRECT" : "POPUP";

        msalApplication.handleRedirectPromise()
            .then(handleResponse)
            .catch(function (error) { console.log(error); }
            );
        // TODO: add CODE before this line
        function updateUserInterface() {
            var divWelcome = document.getElementById('WelcomeMessage');
            divWelcome.innerHTML = 'Welcome <strong>' + userName + '</strong> to Microsoft Identity Platform';

            var loginbutton = document.getElementById('SignIn');
            loginbutton.innerHTML = 'Sign Out';
            loginbutton.setAttribute('onclick', 'signOut();');
        }

        function handleResponse(loginResponse) {
            if (loginResponse != null) {
                userName = loginResponse.account.username;
            } else {
                var currentAccounts = msalApplication.getAllAccounts();
                if (currentAccounts == null || currentAccounts.length == 0) {
                    return;
                } else {
                    userName = currentAccounts[0].username;
                }
            }

            updateUserInterface();
        }

        function signIn() {
            if (loginType == "POPUP") {
                msalApplication.loginPopup()
                    .then(handleResponse)
                    .catch(function (error) { console.log(error); }
                    );
            } else {
                msalApplication.loginRedirect();
            }
        }

        function signOut() {
            var logoutRequest = {
                account: msalApplication.getAccountByUsername(userName)
            };

            msalApplication.logout(logoutRequest);
        }
    // TODO: add FUNCTIONS before this line
    </script>
</body>

</html>